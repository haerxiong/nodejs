var request = require('request');
var fs = require('fs');
var cheerio = require('cheerio');
var query = require('./db.js');

var sql = "insert into data(title,href,reward,ctn,trusteeship,top,manNums,status,create_time,type)"
		+ " value(?,?,?,?,?,?,?,?,sysdate()),'http://task.zbj.com/t-rjkf/p1s5.html'";

var exist = "select 1 from data where href = ?";

request({
    url: 'http://task.zbj.com/t-rjkf/p1s5.html',
    // gzip: true,
    method: 'post'
}, function(err, response, body) {
	$ = cheerio.load(body,{decodeEntities: false});
	$(".unstyled a").each(function(item){
    		// "href" : $(this).find(".list-task-title").attr('href')
    	console.log($(this).html());
		/*query(exist, [obj.href], function(e, rs, fields){
			if(rs.length == 0) {
				query(sql, [
						obj.title,obj.href,obj.reward,obj.ctn
						,obj.trusteeship,obj.top,obj.manNums,obj.status
					], function(e, rs, fields){
					if(e) {
						console.log(e);
					}
				});
			}
		});*/
	});
    // fs.writeFile('output.html', $(".tab-switch").html());
});
